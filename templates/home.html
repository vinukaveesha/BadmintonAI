{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2>Welcome to BadmintonFlex, {{ user }}!</h2>
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Upload Video</h5>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <input class="form-control" type="file" name="file" accept="video/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Analyze Video</button>
                    </form>
                    <div id="uploadResult" class="mt-3"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Live Analysis</h5>
                    <p class="card-text">Real-time shot recognition using your webcam</p>
                    <a href="/live" class="btn btn-success">Start Live Recognition</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('uploadForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const resultDiv = document.getElementById('uploadResult');
    
    resultDiv.innerHTML = '<div class="spinner-border text-primary"></div> Processing...';
    
    try {
        const response = await fetch('/predict', {
            method: 'POST',
            body: formData
        });
        const result = await response.json();
        
        if (result.error) throw new Error(result.error);
        
        resultDiv.innerHTML = `
            <div class="alert alert-success">
                <h5>Prediction: ${result.prediction}</h5>
                <h5>Confidence: ${result.confidence}%</h5>
                <p>${result.message}</p>
            </div>
        `;
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="alert alert-danger">
                Error: ${error.message}
            </div>
        `;
    }
};
</script>
{% endblock %}